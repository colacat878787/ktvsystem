<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>更棒的 YouTube</title>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        /* 在此處新增您的 CSS 樣式 (您可以稍後完善) */
        body {
            font-family: sans-serif;
            background-color: #181818;
            color: #f1f1f1;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        #search-bar {
            display: flex;
            margin-bottom: 20px;
        }
        #search-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #333;
            background-color: #222;
            color: #f1f1f1;
        }
        #search-button {
            padding: 10px 15px;
            background-color: #e50914;
            color: #f1f1f1;
            border: none;
            cursor: pointer;
        }
        #player-area {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto 20px;
            aspect-ratio: 16 / 9;
            background-color: #000; /* 預留播放器位置 */
        }
        #player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #controls {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }
        #play-pause-button, #volume-control {
            margin: 0 10px;
            padding: 8px 12px;
            background-color: #333;
            color: #f1f1f1;
            border: none;
            cursor: pointer;
        }
        #progress-bar-container {
            background-color: #333;
            height: 10px;
            cursor: pointer;
            margin: 0 20px;
            flex-grow: 1;
        }
        #progress-bar {
            background-color: #e50914;
            height: 100%;
            width: 0%;
        }
        #results-list {
            list-style: none;
            padding: 0;
        }
        #results-list li {
            padding: 10px;
            border-bottom: 1px solid #333;
            cursor: pointer;
        }
        #results-list li:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="search-bar">
            <input type="text" id="search-input" placeholder="搜尋 YouTube 影片...">
            <button id="search-button">搜尋</button>
        </div>
        <div id="player-area">
            <div id="player"></div>
        </div>
        <div id="controls">
            <button id="play-pause-button">播放</button>
            <div id="progress-bar-container">
                <div id="progress-bar"></div>
            </div>
            <input type="range" id="volume-control" min="0" max="100" value="100">
        </div>
        <div id="results-container">
            <h2>搜尋結果</h2>
            <ul id="results-list"></ul>
        </div>
    </div>

    <script>
        let player;
        let currentVideoId = null;
        let isPlaying = false;

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '360',
                width: '640',
                videoId: '', // 初始時不載入影片
                playerVars: {
                    'playsinline': 1 // 在行動裝置上內嵌播放
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
            document.getElementById('play-pause-button').textContent = '播放';
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.PLAYING) {
                isPlaying = true;
                document.getElementById('play-pause-button').textContent = '暫停';
                updateProgressBar();
            } else if (event.data === YT.PlayerState.PAUSED) {
                isPlaying = false;
                document.getElementById('play-pause-button').textContent = '播放';
            } else if (event.data === YT.PlayerState.ENDED) {
                isPlaying = false;
                document.getElementById('play-pause-button').textContent = '播放';
                // 影片結束後的處理
            }
        }

        function loadAndPlayVideo(videoId) {
            currentVideoId = videoId;
            player.loadVideoById(videoId);
        }

        function playPauseVideo() {
            if (isPlaying) {
                player.pauseVideo();
            } else {
                player.playVideo();
            }
        }

        function setVolume(volume) {
            player.setVolume(volume);
        }

        function updateProgressBar() {
            if (isPlaying && player && player.getDuration) {
                const duration = player.getDuration();
                const currentTime = player.getCurrentTime();
                const progress = duration ? (currentTime / duration) * 100 : 0;
                document.getElementById('progress-bar').style.width = `${progress}%`;
            }
            if (isPlaying) {
                requestAnimationFrame(updateProgressBar);
            }
        }

        document.getElementById('progress-bar-container').addEventListener('click', (e) => {
            if (player && player.getDuration) {
                const totalWidth = e.target.offsetWidth;
                const clickPosition = e.offsetX;
                const newTime = (clickPosition / totalWidth) * player.getDuration();
                player.seekTo(newTime, true);
            }
        });

        document.getElementById('play-pause-button').addEventListener('click', playPauseVideo);

        document.getElementById('volume-control').addEventListener('input', (e) => {
            setVolume(e.target.value);
        });

        async function searchYouTube(query) {
            // --- 這裡將整合您的 Supadata.ai API ---
            // 這個範例仍然使用模擬資料
            return new Promise((resolve) => {
                setTimeout(() => {
                    const mockResults = [
                        { id: 'dQw4w9WgXcQ', title: 'Rick Astley - Never Gonna Give You Up (Official Music Video)' },
                        { id: 'fJ9rUzIMcZQ', title: 'Queen - Bohemian Rhapsody (Official Video)' },
                        { id: 'YOcmSsBfafg', title: 'Adele - Hello (Official Music Video)' }
                    ];
                    const filteredResults = mockResults.filter(item =>
                        item.title.toLowerCase().includes(query.toLowerCase())
                    );
                    resolve(filteredResults.slice(0, 10)); // 返回前 10 個結果
                }, 500);
            });
        }

        function displaySearchResults(results) {
            const resultsList = document.getElementById('results-list');
            resultsList.innerHTML = '';
            results.forEach(result => {
                const listItem = document.createElement('li');
                listItem.textContent = result.title;
                listItem.addEventListener('click', () => {
                    loadAndPlayVideo(result.id);
                });
                resultsList.appendChild(listItem);
            });
        }

        document.getElementById('search-button').addEventListener('click', async () => {
            const query = document.getElementById('search-input').value;
            const results = await searchYouTube(query);
            displaySearchResults(results);
        });
    </script>
</body>
</html>
